## ExpressJS Sub Domain Hosting with Apache

I got the guide and inspiration from these article:

- [sub-domain setting with apache](https://codeburst.io/configuring-a-subdomain-in-apache2-f7a8b316b42c)
- [ExpressJS Apache Hosting Setup](https://medium.com/@nutanbhogendrasharma/host-node-express-application-in-apache-webserver-in-ubuntu-server-a8718ace324e)

In short, this is what I do to achieve the desired result:

**1. Make "A Record" in the domain provider dashboard (I use Hostinger) to point the sub-domain we want -> to our IP address**

For example, I use this values:

```
Host/Name: test.candracodes.space
Target/To: <My VPS IP>
TTL: 3600
```

**2. Enable proxy_http module in Apache**

```bash
sudo a2enmod proxy_http
```

and restart the apache2 service

```bash
sudo systemctl restart apache2
```

**3. Create a VHost conf in Apache**

I use this conf:

```apache
# /etc/apache2/sites-available/test.candracodes.space.conf
<VirtualHost *:80>
    ServerAdmin admin@example.com
    ServerName test.candracodes.space
    DocumentRoot /var/www/html/test-html/

    ProxyPreserveHost On

    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    <Directory /var/www/html/test-html/>
            Options Indexes MultiViews
            AllowOverride All
            Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
RewriteEngine on
RewriteCond %{SERVER_NAME} =test.candracodes.space
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
```

The most important things to look here is the ProxyPreserveHost, ProxyPass, ProxyPassReverse part, those line are our ways telling apache to redirect/proxy the request incoming to our ExpressJS app (in my case here is on localhost:3000 ).
And also don't forget about ServerName, we must specify our sub domain that we register earlier in "A Record".

After that we need to enable the conf/site file we just created:
```bash
sudo a2ensite test.candracodes.space 
```

**4. Re-run certbot to get certificate for https access.**

In Laravel hosting that I created before, I used certbot to create free ssl certificate that allows us using https in our site.
We will need to re-run certbot to create another ssl certificate for our subdomain. Just run
```bash
certbot
```
and choose the sub domain we just create, and certbot will do the hardwork for us.

**5. Start the express web server**
You can use simple command like ```node index.js``` or you can use some daemon proccess like nodemon or pm2 to manage the expressjs proccess. Don't forget to match the port in apache conf file.

**6. We actually done and it's time to test our new sub domain**

***NOTE: If we edit the conf file, don't forget to also edit the ssl conf file that auto generated by certbot***
If for example we need to change the sub domain url, don't forget to also edit the file for https/ssl conf that are auto generated by certbot. Usually, it has the same name but appended by "le-ssl" or something like that. 
And also don't forget to restart the apache2 service for change to take effect.